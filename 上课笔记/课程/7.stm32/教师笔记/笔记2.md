
前一天作业：

1. 什么是嵌入式系统？

   以应用为中心，以计算机技术为基础，软件硬件均可裁减，满足应用系统对功能、
   功耗、成本、可靠性、体积等有严格要求的专用计算机系统。
   
   嵌入到对象系统中的计算机系统。
   
2. 最小系统由哪些部分组成？

   MCU/MPU内核 + 复位系统 + 电源系统 + 时钟系统 + FLASH + RAM + JTAG
   
3. 什么是 ARM？

   ARM 是高级精简指令集机器，是一种计算机体系结构。低功耗、高性能。
   ARM 是英国的一家芯片公司。不生产不销售芯片，只卖内核、体系结构方案。
   
4. Cortex-A 系列用于什么产品？

   应用型，如：手机，平板
   
5. Cortex-R 系列用于什么产品？

   实时型，如：汽车制动系统、安全气囊，打印机
   
6. Cortex-M 系列用于什么产品？

   价廉物美型，如：智能家居、医疗设备。
   
7. Cortex-M3 的体系结构是什么？

   ARMv7M
   
8. STM32F103RC 的内核是什么？

   Cortex-M3
   
9. 每个芯片一般包含哪几个层次的型号/版本号？

   芯片编号，如：STM32F103RCT6
   内核编号，如：Cortex-M3
   体系结构编号，如：ARMv7M
   
10. mcuisp 工具烧录需要什么文件？

    .hex 文件
	可由 keil 自动生成。
	
11. Keil 可以烧录程序到开发板吗？

    可以，比如：ST-LINK。通过 demo.axf 烧录。
	
12. 由 .axf 文件生成 .bin 文件的命令？

    fromelf.exe --bin -o .\Objects\demo.bin .\Objects\demo.axf
	
	其中 .\Objects\demo.bin 路径名和文件名都可以取别的名称
	.\Objects\demo.axf 必须是已存在的路径和文件，也可以是别的路径和文件名。
	
13. 独立创建一个工程，复制课堂演示的 main.c 的代码，用 ST-LINK 和 MCUISP 两种方式烧录并运行。
	
14. 使用 ST-LINK 调试程序。

============================================================================================

1. 相关资料

《FREE-IOT32V2.0.pdf》开发板原理图
《STM32F10xxx20xxx21xxxL1xxxx Cortex-M3 programming manual.pdf》芯片编程手册 - 指令集、内核外设
《STM32F10xxx参考手册中文版.pdf》参考手册 - 各个外设的使用：功能描述，寄存器描述
《stm32f103rc_datasheet.pdf》数据手册 - 引脚定义，外设的电子特征，内在映射

2. GPIO 通用输入输出

   MCU 中专门管理 IO 口的设备称为 GPIO。
   每个 GPIO 最只能管理 16 个 IO 口。但 MCU 的 IO 口往往不止 16 个，因此需要多个这样的外设。
   将它们编号为 GPIOA, GPIOB, GPIOC, GPIOD, GPIOE, GPIOF, GPIOG, ...，也称为端口。
   
   IO 口的命名：
   
   GPIOA: PA0, PA1, ... PA15
   GPIOB: PB0, PB1, ... PB15
   GPIOC: PC0, PC1, ... PC15
   GPIOD: PD0, PD1, ... PD15

   通过 GPIO 端口就可以向 IO 口输出高低电平，也可以从 IO 口读取电平。
   
3. GPIO 的寄存器

   GPIO 端口如何控制那些 IO 口呢？
   通过 GPIO 端口内部的寄存器来进行控制。
   
   每个 GPIO端口 有 7 个寄存器：
   
   两个32位配置寄存器(GPIOx_CRL，GPIOx_CRH)，因为每个 IO 口需要 4 个位来配置，16 个 IO 口需要 64 个位，因此需要两个寄存器。CRL 管理 IO0~IO7，CRH 管理 IO8~IO15
   两个32位数据寄存器(GPIOx_IDR，GPIOx_ODR)，只能用低 16 位，每个 IO 口对应到 IDR/ODR 的一个位
   一个32位置位/复位寄存器(GPIOx_BSRR)，
   一个16位复位寄存器(GPIOx_BRR)，
   一个32位锁定寄存器(GPIOx_LCKR)。

4. GPIO 端口位的 8 种模式

   GPIO端口的每个位可以由软件分别配置成多种模式。
   
   4 种输入模式：
   
   ─ 输入浮空 
   ─ 输入上拉 
   ─ 输入下拉 
   ─ 模拟输入 
   
   输入浮空时，输入的信号电平由外部电路决定。但如果外部也是浮空，则输入信号可能不确定。
   但是由于逻辑电路的特性，使得最终会得到高电平。要避免这种情况出现。
   
   配置为输入上拉时，外部电路如果是低电平，则输入得到低电平；
   配置为输入下拉时，外部电路如果是高电平，则输入得到高电平。

   配置为模拟输入时，施密特触发器关闭，并强制向 IDR 输出 0，从 IDR 只能读到 0。
   
   4 种输出模式：
   
   ─ 通用开漏输出 
   ─ 通用推挽式输出 
   ─ 推挽式复用功能 
   ─ 开漏复用功能 
   
   推挽用于输出数字信号。
   
   推挽：MCU 输出 0 时，P-MOS 禁用，N-MOS 激活，IO 口输出低电平（0）
         MCU 输出 1 时，P-MOS 激活，N-MOS 禁用，IO 口输出高电平（1）
		 
   开漏，P-MOS 始终禁用：
         MCU 输出 0 时，N-MOS 激活，IO 口输出低电平（0）
		 MCU 输出 1 时，N-MOS 高阻抗，IO 口电平由外部电路决定

   开漏一般用于：
   
   . "线与"功能
   . 电流型驱动
   
   这些 IO 口可以独立编程（配置），但必须以 32 位整体访问。

   GPIOx_BSRR和GPIOx_BRR寄存器允许对任何GPIO寄存器的读/更改的独立访问；
   这样，在读和更改访问之间产生IRQ时不会发生危险。
   通过 BSRR 或 BRR 来写 ODR 不会被中断，写操作是"原子"的。因此是安全。
   
5. 通用功能与复用功能

   通用功能即直接通过 GPIO 端口来对 IO 口进行输入输出。
   复用功能即除 GPIO 端口之外的其它外设的输入输出。

6. 嵌入式软件开发的前提

   . 需求分析
   . 硬件：开发板，各种外设
   . 烧录工具：USB 线，ST-LINK，J-link，JTAG 等
   . 烧录工具的驱动程序
   . 开发工具软件：Keil，IAR，STM32CubeMX
   . 烧录/调试软件（可选）：MCUISP，FLYMCU
   . 资料：原理图，芯片手册（数据手册，编程手册，参选手册），外设手册

7. 蜂鸣器配置步骤

   . 查看原理图，得到 BEEP - PC9，并且 PC9 输出高电平关闭蜂鸣器，低电平则打开。
   
   . 使能 GPIOC 时钟。查数据手册或参考手册得 GPIOC 属于 APB2 总线，
     因此通过将 RCC_APB2ENR 寄存器 [4] 位置 1 打开 GPIOC 时钟。
	 
     RCC_APB2ENR |= 1 << 4;
     
   . 配置 PC9 为通用推挽输出。查参考手册 GPIOC_CRH 如何配置。
   
     GPIOC_CRH &= ~(0xF << 4);   // 先将 GPIOC_CRH[7:4] 清 0
	 GPIOC_CRH |= 0x3 << 4;      // 再将 GPIOC_CRH[7:4] 赋值为 0x3 (0b0011)
   
   . 打开/关闭蜂鸣器：
   
     直接操作 ODR 寄存器的方法：
   
     #define BEEP_ON()   GPIOC_ODR &= ~(1 << 9)
     #define BEEP_OFF()  GPIOC_ODR |= 1 << 9
     
     或者，通过 BSRR 和 BRR 写 ODR 的方法：

     #define BEEP_ON()   GPIOC_BRR |= 1 << 9     // 写 1 清 0
     #define BEEP_OFF()  GPIOC_BSRR |= 1 << 9

     另外也可以通过 BSRR 写 ODR 打开蜂鸣器：
     
     #define BEEP_ON()   GPIOC_BSRR |= 1 << 25   // 高 16 位写 1 清 0
          
   . RCC_APB2ENR 地址怎么查？
   
     先查参考手册的《2.3 存储器映像》表，找到 RCC 的起始地址为 0x40021000，
     再查找 RCC_APB2ENR 的偏移地址为 0x18，因此 RCC_APB2ENR 的地址为 (0x40021000 + 0x18)
   
     GPIOC_CRH、GPIOC_ODR、GPIOC_BSRR、GPIOC_BRR 的地址方法相同。

========================================================================================

作业：

1. 说出GPIO以寄存器方式的配置步骤

2. 使用寄存器方式实现蜂鸣器 

3. 什么是复用功能？

4. 使用寄存器方式实现 LED R 流水灯

5. 解释开漏输出，以及开漏实现 "线与" 功能

6. 解释推挽输出





