我们已知，市面上的示波器的输入阻抗为1Mohm
而我希望可以让示波器可以直接接入到市电中进行波形的测量，百度查找得知，市电电压峰值为310V，那么峰峰值为620V左右。
但是，购买到的示波器探头的最大可承受电压的峰峰值为600V，因此不能做到直接接入市电
# 这个是示波器探头的相关参数
![[Pasted image 20231227142502.png]]
补偿电容仅在10x的时候可用

接下来，我直接进入到了ADC的选型，我选择的是
HMCAD1511

这个采样器件具有极高的性能以及性价比，适用于便携式示波器

接下来要知道其电路原理图如何绘制
首先，要知道其QFN封装，嘉立创打板支不支持
[嘉立创工艺](https://www.jlc.com/portal/vtechnology.html)
我决定使用4层板，高速电路我觉得需要4层板
经过查看，嘉立创支持的最小线宽为0.10mm，远小于0.25mm的QFN焊盘

因此可以用这个ADC

接下来要思考ADC的电路原理图
查看手册的27页，以获取Recommended Usage

其描述了ADC的一个制作工艺，是使用开关带绒追踪保持放大器优化过的差分输入的ADC
推荐我们操作在共模电压的一半，VCM引脚会输出AVDD的一半电压，适用于作为共模电压的参考
VCM的电压可以被内部缓冲区关闭，通过配置ext_vcm_bc<1:0>寄存器

开始介绍芯片输入网络的简化图
![[Pasted image 20231228152651 1.png]]
这里要求输出阻抗足够小，以便于采样电容充电
建议在每个输入端串联一个小的外部电阻(例如22欧姆)，因为它有助于减少瞬态电流并抑制振铃行为。
电阻器芯片一侧的小差分并联电容器可用于提供动态充电电流，并可提高性能。
这个电阻与电容形成了低通滤波器，但是这个电容值需要由应用的要求确定

这里开始介绍直流耦合输入的形式
![[Pasted image 20231228145826 1.png]]
共模输入电压，必须根据规定的输入数值进行控制，以免烧坏芯片
最好使用CM_EXT（ACM引脚）输出作为基准来设置共模电压。
市面上具有一些适合HMCAD1511的单端到差分放大器，要注意放大器要适合于这款ADC的输入要求
要在ADC的驱动文档中找到详细的关于输出阻抗的说明，并根据图12的内容进行合适的修改

看到这里，我决定使用直流耦合，并且找到适合这款ADC的驱动

偶然间看见了HMCAD1511的[封装库](https://vendor.ultralibrarian.com/adi/embedded?vdrPN=HMCAD1511)

然后看到了[EVALUATING THE HMCAD1511/HMCAD1520 ANALOG-TO-DIGITAL CONVERTERS](https://wiki.analog.com/resources/eval/hmcad15xx)HMCAD15xx的评估板

通过评估板给出的信息，我找到了ADC的一个配套驱动
LTC6419HV
但是价格太高了，不适合我等穷逼
所以，要买一个替代品
单端差分运放，买一个增益带宽比400MHz的就可以了
EL2141CS系列可能挺不错的
但是这个芯片的偏置电流太大了，所以不利于示波器的测量

一番抉择下来，还是选择使用AD9288BSTZ-100芯片
最重要的是便宜！
我打算使用一块AD9288BSTZ-100芯片来完成我的毕设
已经买好了自己做毕设的芯片了，接下来，应该需要为芯片绘制外围电路

看了一段时间的数据手册，可以发现，
- 芯片选型需要分析芯片参数规范
- 想要分析连接这个芯片的其他电路，需要分析芯片的绝对最大额定功率，根据绝对最大额定功率来设计芯片外围的其他电路
- 想要知道电路的内部原理，需要借助经验，如果没有相关经验，就需要去互联网搜索
- 绝对需要注意手册的TROUBLESHOOTING

偶然间得知：[高速差分 ADC 驱动器设计指南](https://www.analog.com/cn/analog-dialogue/articles/rules-for-high-speed-differential-adc-drivers.html)

怎么绘制呢？
需要有对应的参考设计
需要查看数据手册的绝对最大额定功率
需要查看数据手册中，关于元器件使用的指南
# 查看AD9288的元件使用指南
AD9288关于元器件使用的指南在p14
它首先介绍了，ADC的架构，bit-per-stage pipeline-type converter，利用了开关电容技术。
每个阶段确定了5个MSBs，并驱动了3位flash
每个stage提供了足够多的重叠以及误差校正，让比较器的精度得到优化
输入缓冲区是差分的，并且都具有输入的内部偏置，这允许我们既可以使用单端，又可以使用差分，既可以使用直流，也可以使用交流
输出的分段块进行了数据对齐，并且还进行了纠错，然后填充数据到缓冲区当中
这组输出的缓冲区具有单独供电，允许调整输出电压的摆动
两个输入通道没有明显的性能差异
## 如何使用AD9288
在使用AD9288时，必须具有好的告诉设计实践。
为了获取最高的收益，解耦电容的放置尽量接近芯片，让芯片与电源之间的走线与导通电感最小。AD9288的PCB评估板使用0603贴片电容
芯片上每个电源到地之间，都放置一个0.1uf的电容，用于高频解耦，以及加一个10uf的电容用于低频解耦
参考输入引脚，也应该放置一个输入0.1uf的输入电容
也需要分开电源地与连续地平面
数据输出走线应该尽量短（<1 inch），最小化芯片上的开关噪声
## 编码输入
ADC对采样时钟的质量要求很高
跟踪保持电路本质上是一个乘法器，任何时钟上的噪声，市镇，时序抖动，都会和理想的输入信号进行组合并形成ADC的输出
因此，在设计AD9288的编码时钟时，必须要小心时钟的输入
编码时钟的输入应该完全兼容TTL/CMOS输入
## 数字输出
数字输出时兼容TTL/CMOS并且低功耗
待机期间，输出缓冲区过渡到高阻抗状态
数据格式选择支持补码和移码
## 模拟输入
AD9288的模拟输入时差分缓冲区
最优性能下，Ain都应该及逆行阻抗匹配
特别注意设计AD9288模拟输入的阶段，要防止输入过大而损坏数据
平常的输入范围在1.024Vp-p之间，居中于Vd x 0.3
## 电压参考
REFout会输出1.25V的稳定参考
平时需要让567号引脚接起来
输入范围可以被参考引脚进行调节
电压基准在+-5%的情况下，不会有太大的改变
ADC的整个量程都是线性的
## 时序
AD9288提供了输出数据锁存，带有4个流水线的延迟
数据输出可以在时钟编码命令的上升沿的一个传输时延的时间中获取
数据输出线的长度尽可能小，以及放在它们之间的负载尽可能的小，以减少AD9288的瞬变
这些瞬变会降低转换器的动态性能
保证AD9288运行的最小转换速率为1MSPS
上电后，从待机模式恢复为15个时钟周期
## 用户可选择的选项
两个引脚可用于操作模式的组合。
这些选项允许用户将两个通道(不包括参考)置于待机模式，或仅B通道。
两种模式都将输出缓冲器和时钟输入置于高阻抗状态。
两个引脚可用于操作模式的组合。
这些选项允许用户将两个通道(不包括参考)置于待机模式，或仅B通道。
两种模式都将输出缓冲器和时钟输入置于高阻抗状态。

另一个选项允许用户将B通道输出数据倾斜1/2个时钟周期。
换句话说,如果两个时钟是美联储AD9288和180°的阶段,使数据对齐允许B通道输出数据可以在时钟的上升边答:如果相同的编码时钟提供通道和数据对齐启用销,然后输出数据通道B是180°的阶段对通道如果相同的编码时钟提供通道和数据对齐销被禁用,两个输出都在时钟的同一上升沿上传送。

这里是用来设置通道开关的

# 绘制电路
接下来，开始根据使用指南来选择并放置元器件
我首先将电路中所需要的电容都放置在了原理图中，全都是0603封装的电容
然后，我需要知道，其对应的电源，应该设置为多少
根据其测试参数，我选择让Vdd与Vd分别都设置为3.0V

现在已经画完了ADC的外围电路了，之后应该要怎么做呢？
我想应该是绘制ADC的前级电路，高速信号调理电路
那，应该要怎么绘制呢？
首先查看电路原理图，可以看见，里面只有ADC，但是，却没有ADC的差分输入电路，那怎么办呢？
还缺少了ADC的时钟编码电路，还有ADC的采样数据接收电路，以及ADC模式选择电路
现在，我想要先确定ADC的输入电路，该怎么设计呢？
应该是选用相应的ADC驱动器，这个可以在ADI的官网找到
查看了一下，价格非常高，怎么办呢？
我需要打下价格，也需要知道，究竟要怎样选择合适的差分运放
那么，问题就来到了，如何选择合适的差分运放？如何计算差分运放的各个参数呢？
那就要看差分运放的选型手册了
去谷歌找了一下，发现运放的相关知识非常的多，看来需要熟知各个关于运算放大器的术语才行
那么，接下来开始对运放术语的学习
在此之前，还需要知道，究竟要不要学习这个术语
首先，需要知道的是：差分运放到底要不要通过学习运放的术语来选择。
我觉得，首先需要知道，需要选择什么元器件，来接ADC的前端。
所以，需要选择什么元器件，来接ADC的前端呢？
不知道，但是，需要保证，50MHz的信号，通过差分运放之后，频率和原来一模一样才是。
这个要怎么才能保证呢？
不知道，可以问问AI
### 询问AI之后的结果
选择一款适合输入50MHz信号的差分运放，需要考虑以下几个关键参数：
1. **增益带宽积 (GBW)**: 这是一个重要的参数，它决定了运放在给定频率下能提供的最大增益。例如，如果一个运放的GBW是100MHz，那么在50MHz的频率下，它能提供的最大增益是2
2. **摆率 (Slew Rate)**: 这个参数决定了运放输出电压变化的最大速度。对于高频信号，需要一个具有较大摆率的运放以避免失真。
3. **失调电压 (Offset Voltage)**: 对于精度较高的应用，应选择失调电压小的运放
4. **输入偏执电流 (Input Bias Current)**: 一般选用低偏执电流的运放
5. **共模抑制比 (CMRR)**: 高CMRR可以减少不必要的噪声
6. **直流精度**: 通过零漂移可确保长期稳定性，通过 e-trim 可消除封装应力参数变化，并通过高度匹配的 0.001% 薄膜电阻器保持高 CMRR 和低增益误差
7. **共模输入范围**: 可在高达 ±550V 的高共模电压下进行精确测量，从而实现高电压应用
8. **功耗**: 使用静态电流消耗低至 160µA 的精密差分放大器实现电池供电型应用
但是，我看不懂啊？
那就只好一个一个地学了
首先需要先复习[集成运放的主要性能指标](https://www.bilibili.com/video/BV1Vp411f71S?p=64)
## 运算放大器的术语
[[1.运算放大器常见参数]]

接下来是选择差分运放的时候，我该如何选择差分运放呢？
我需要设定一个转换速率，以使得示波器能跟上我所期望的输入信号，并且，我还希望差分运放的输入偏置电流尽可能的小。
我希望，在示波器的两次采样期间，外部输入信号的转变可以达到100V
即，10ns可以变化100V？这样，会不会太大了？
查看了毕设要求，发现确实有些大了。
那么，我希望10ns变化10V，那么1000V/us，感觉也还是太大了，也许100V/us就可以了，即10ns变化1V
但是，这样的差分运放，似乎没有很好的输入偏置电流，那就先选输入偏置电流，再选压摆率。
输入到示波器上，可以识别的最大频率的信号为50MHz，因此选择增益带宽积的值为50MHz即可
最接近的可以找到的为68MHz的差分运放
这里，选择ADA4932-1，这里是AD9288配套的，最低价格的ADC驱动器
选择好了之后，我需要知道ADC的输入信号的范围
峰峰值在1.024V左右，然后，手册里并未说清楚ADC的输入范围是多少，所以我们需要查找ADI的论坛来寻求相关的解决方案，通过别人的问答可知：
Ain的绝对电压范围为1V+256mV 到 1V-256mV。Ain-的电压范围为1V-256mV 到1V+256mV 到。这样两者电压相减，恰好为+512mV到-512mV。
因此，输入到ADC的差分输入的共模电压，应该为Vd x 0.3V，我这里就是0.9V
所以，此时我要保证差分运放输出的电压在ADC的输入电压内
差分输入的共模电压，应为0.9V，并且ADC的正端，输入0.9±0.256V，ADC的负端，输入0.9±0.256V
那么，现在开始查看差分运放的输出
